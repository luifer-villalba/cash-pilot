#!/usr/bin/env bash
echo "ğŸ” Running linters..."
docker compose run --rm app bash -lc "ruff check src && black --check src && isort --check-only src" || exit 1

echo "ğŸ“ Checking file lengths..."
docker compose run --rm app python -c "
import sys
from pathlib import Path
files = [f for f in Path('src/cashpilot').rglob('*.py') if not any(x in f.parts for x in {'.venv','__pycache__','.git','alembic'})]
violations = [(f, sum(1 for _ in open(f))) for f in files if sum(1 for _ in open(f)) > 400]
if violations:
    print('âŒ Files exceed 400 lines:')
    for f, l in violations: print(f'  â€¢ {f}: {l} lines')
    sys.exit(1)
print('âœ… All files under 400 lines!')
" || exit 1

echo "âœ… All checks passed!"